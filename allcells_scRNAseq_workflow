!pip install scanpy mygene
import scanpy as sc
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
import mygene

#Read the datafile containing data of interest
adata=sc.read('allcellsmrca.h5ad')

# Initialize the mygene query
mg = mygene.MyGeneInfo()

# Fetch gene symbols for your Ensembl IDs
ens_ids = adata.var_names.tolist()  # Get the list of Ensembl IDs
gene_info = mg.querymany(ens_ids, scopes='ensembl.gene', fields='symbol', species='mouse')

# Convert results into a dictionary with Ensembl IDs as keys and gene symbols as values
gene_symbol_dict = {item['query']: item.get('symbol', item['query']) for item in gene_info}

# Remap adata.var_names with the gene symbols
adata.var['gene_symbols'] = [gene_symbol_dict[ens_id] for ens_id in adata.var_names]

# Optionally set the gene symbols as var_names (so that dotplots and other functions use gene symbols)
adata.var_names = adata.var['gene_symbols']
adata.var_names_make_unique()


